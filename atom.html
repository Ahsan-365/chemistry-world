<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Atom Simulator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <!-- Three.js library for 3D rendering -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <!-- OrbitControls for interactive camera movement in 3D -->
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f2f5;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            box-sizing: border-box;
            color: #333;
        }
        .container {
            background-color: #ffffff;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            padding: 24px;
            max-width: 600px;
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        h1 {
            font-size: 2.5rem;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 20px;
            text-align: center;
        }
        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 16px;
            justify-content: center;
            align-items: center;
            margin-bottom: 24px;
            width: 100%;
        }
        label {
            font-weight: 600;
            color: #555;
        }
        input[type="number"] {
            padding: 10px 14px;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            font-size: 1rem;
            color: #333;
            background-color: #f9fafb;
            transition: border-color 0.2s, box-shadow 0.2s;
            min-width: 120px;
        }
        input[type="number"]:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.25);
        }
        .mode-selection {
            display: flex;
            gap: 10px;
            background-color: #e2e8f0;
            padding: 8px;
            border-radius: 12px;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.1);
        }
        .mode-selection label {
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.2s, color 0.2s;
            font-weight: 500;
            color: #4a5568;
        }
        .mode-selection input[type="radio"] {
            display: none;
        }
        .mode-selection input[type="radio"]:checked + label {
            background-color: #3b82f6;
            color: white;
            box-shadow: 0 2px 5px rgba(59, 130, 246, 0.3);
        }

        .canvas-container {
            width: 100%;
            max-width: 500px; /* Max width for the canvas */
            aspect-ratio: 1 / 1; /* Keep it square */
            background-color: #ecf0f1;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.05);
            margin-top: 20px;
            position: relative; /* Needed for absolute positioning of children */
        }
        .canvas-container canvas {
            position: absolute; /* Position both canvases on top of each other */
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: block; /* Default to block, then control visibility with JS */
        }
        .element-info {
            margin-top: 24px;
            background-color: #ecf0f1;
            border-radius: 12px;
            padding: 16px;
            width: 100%;
            max-width: 400px;
            text-align: center;
            font-size: 1.1rem;
            color: #2c3e50;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
        }
        .element-info p {
            margin: 8px 0;
        }
        .element-info strong {
            color: #34495e;
        }

        /* Responsive adjustments */
        @media (max-width: 600px) {
            h1 {
                font-size: 2rem;
            }
            .controls {
                flex-direction: column;
                align-items: stretch;
            }
            input[type="number"] {
                width: 100%;
            }
            .mode-selection {
                width: 100%;
                justify-content: space-around;
            }
            .mode-selection label {
                flex-grow: 1;
                text-align: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Atom Simulator</h1>

        <div class="controls">
            <div>
                <label for="atomicNumberInput" class="block text-sm font-medium text-gray-700">Atomic Number:</label>
                <input type="number" id="atomicNumberInput" value="1" min="1" max="118"
                       class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md">
            </div>
            <div class="mode-selection">
                <input type="radio" id="mode2D" name="mode" value="2D" checked>
                <label for="mode2D">2D View</label>
                <input type="radio" id="mode3D" name="mode" value="3D">
                <label for="mode3D">3D View</label>
            </div>
        </div>

        <div class="canvas-container">
            <canvas id="atomCanvas2D"></canvas>
            <canvas id="atomCanvas3D"></canvas>
        </div>

        <div class="element-info" id="elementInfo">
            <p><strong>Element:</strong> <span id="infoName">Hydrogen</span></p>
            <p><strong>Symbol:</strong> <span id="infoSymbol">H</span></p>
            <p><strong>Atomic Number:</strong> <span id="infoAtomicNumber">1</span></p>
            <p><strong>Shells:</strong> <span id="infoShells">[1]</span></p>
        </div>
    </div>

    <script>
        // Get canvas elements
        const canvas2D = document.getElementById('atomCanvas2D');
        const canvas3D = document.getElementById('atomCanvas3D');
        let ctx = null; // Will be initialized for 2D mode

        // Three.js variables
        let scene, camera, renderer, controls;
        let currentAtomGroup = null; // Holds the 3D atom group object

        // UI elements
        const atomicNumberInput = document.getElementById('atomicNumberInput');
        const mode2DRadio = document.getElementById('mode2D');
        const mode3DRadio = document.getElementById('mode3D');
        const infoElement = document.getElementById('elementInfo');
        const infoName = document.getElementById('infoName');
        const infoSymbol = document.getElementById('infoSymbol');
        const infoAtomicNumber = document.getElementById('infoAtomicNumber');
        const infoShells = document.getElementById('infoShells');

        let currentMode = '2D'; // Default mode

        // Data for elements (up to 118, simplified electron shell configuration)
        // Added 'color' property for 3D visualization. Shells are simplified for visual representation.
        const elements = [
            { atomicNumber: 1, name: "Hydrogen", symbol: "H", shells: [1], color: 0xFFFFFF, neutrons: 0 },
            { atomicNumber: 2, name: "Helium", symbol: "He", shells: [2], color: 0xD9FFFF, neutrons: 2 },
            { atomicNumber: 3, name: "Lithium", symbol: "Li", shells: [2, 1], color: 0xCC80FF, neutrons: 4 },
            { atomicNumber: 4, name: "Beryllium", symbol: "Be", shells: [2, 2], color: 0xC2FF00, neutrons: 5 },
            { atomicNumber: 5, name: "Boron", symbol: "B", shells: [2, 3], color: 0xFFB5B5, neutrons: 6 },
            { atomicNumber: 6, name: "Carbon", symbol: "C", shells: [2, 4], color: 0x909090, neutrons: 6 },
            { atomicNumber: 7, name: "Nitrogen", symbol: "N", shells: [2, 5], color: 0x3050F8, neutrons: 7 },
            { atomicNumber: 8, name: "Oxygen", symbol: "O", shells: [2, 6], color: 0xFF0D0D, neutrons: 8 },
            { atomicNumber: 9, name: "Fluorine", symbol: "F", shells: [2, 7], color: 0x9AFF9A, neutrons: 10 },
            { atomicNumber: 10, name: "Neon", symbol: "Ne", shells: [2, 8], color: 0xB3E3F5, neutrons: 10 },
            { atomicNumber: 11, name: "Sodium", symbol: "Na", shells: [2, 8, 1], color: 0xAB5B00, neutrons: 12 },
            { atomicNumber: 12, name: "Magnesium", symbol: "Mg", shells: [2, 8, 2], color: 0x8AFF00, neutrons: 12 },
            { atomicNumber: 13, name: "Aluminum", symbol: "Al", shells: [2, 8, 3], color: 0xBFA6A6, neutrons: 14 },
            { atomicNumber: 14, name: "Silicon", symbol: "Si", shells: [2, 8, 4], color: 0xF0C8A0, neutrons: 14 },
            { atomicNumber: 15, name: "Phosphorus", symbol: "P", shells: [2, 8, 5], color: 0xFF8000, neutrons: 16 },
            { atomicNumber: 16, name: "Sulfur", symbol: "S", shells: [2, 8, 6], color: 0xFFFF30, neutrons: 16 },
            { atomicNumber: 17, name: "Chlorine", symbol: "Cl", shells: [2, 8, 7], color: 0x1FF01F, neutrons: 18 },
            { atomicNumber: 18, name: "Argon", symbol: "Ar", shells: [2, 8, 8], color: 0x80D1EA, neutrons: 22 },
            { atomicNumber: 19, name: "Potassium", symbol: "K", shells: [2, 8, 8, 1], color: 0x8F40F0, neutrons: 20 },
            { atomicNumber: 20, name: "Calcium", symbol: "Ca", shells: [2, 8, 8, 2], color: 0x3DFF00, neutrons: 20 },
            { atomicNumber: 21, name: "Scandium", symbol: "Sc", shells: [2, 8, 9, 2], color: 0xE6E6E6, neutrons: 24 },
            { atomicNumber: 22, name: "Titanium", symbol: "Ti", shells: [2, 8, 10, 2], color: 0xBFBFBF, neutrons: 26 },
            { atomicNumber: 23, name: "Vanadium", symbol: "V", shells: [2, 8, 11, 2], color: 0xA6A6AB, neutrons: 28 },
            { atomicNumber: 24, name: "Chromium", symbol: "Cr", shells: [2, 8, 13, 1], color: 0x8A99C7, neutrons: 28 },
            { atomicNumber: 25, name: "Manganese", symbol: "Mn", shells: [2, 8, 13, 2], color: 0x9C7AC7, neutrons: 30 },
            { atomicNumber: 26, name: "Iron", symbol: "Fe", shells: [2, 8, 14, 2], color: 0x7F7F7F, neutrons: 30 },
            { atomicNumber: 27, name: "Cobalt", symbol: "Co", shells: [2, 8, 15, 2], color: 0xF090A0, neutrons: 32 },
            { atomicNumber: 28, name: "Nickel", symbol: "Ni", shells: [2, 8, 16, 2], color: 0x50D050, neutrons: 31 },
            { atomicNumber: 29, name: "Copper", symbol: "Cu", shells: [2, 8, 18, 1], color: 0xC88033, neutrons: 35 },
            { atomicNumber: 30, name: "Zinc", symbol: "Zn", shells: [2, 8, 18, 2], color: 0x7D80B0, neutrons: 35 },
            { atomicNumber: 31, name: "Gallium", symbol: "Ga", shells: [2, 8, 18, 3], color: 0xC28F8F, neutrons: 39 },
            { atomicNumber: 32, name: "Germanium", symbol: "Ge", shells: [2, 8, 18, 4], color: 0x668F8F, neutrons: 41 },
            { atomicNumber: 33, name: "Arsenic", symbol: "As", shells: [2, 8, 18, 5], color: 0xBD80FF, neutrons: 42 },
            { atomicNumber: 34, name: "Selenium", symbol: "Se", shells: [2, 8, 18, 6], color: 0xFF7F00, neutrons: 45 },
            { atomicNumber: 35, name: "Bromine", symbol: "Br", shells: [2, 8, 18, 7], color: 0xA62929, neutrons: 45 },
            { atomicNumber: 36, name: "Krypton", symbol: "Kr", shells: [2, 8, 18, 8], color: 0x5CB8D1, neutrons: 48 },
            { atomicNumber: 37, name: "Rubidium", symbol: "Rb", shells: [2, 8, 18, 8, 1], color: 0x702EB0, neutrons: 48 },
            { atomicNumber: 38, name: "Strontium", symbol: "Sr", shells: [2, 8, 18, 8, 2], color: 0x00FF00, neutrons: 50 },
            { atomicNumber: 39, name: "Yttrium", symbol: "Y", shells: [2, 8, 18, 9, 2], color: 0x94FFFF, neutrons: 50 },
            { atomicNumber: 40, name: "Zirconium", symbol: "Zr", shells: [2, 8, 18, 10, 2], color: 0x94E0E0, neutrons: 51 },
            { atomicNumber: 41, name: "Niobium", symbol: "Nb", shells: [2, 8, 18, 12, 1], color: 0x73A3C7, neutrons: 52 },
            { atomicNumber: 42, name: "Molybdenum", symbol: "Mo", shells: [2, 8, 18, 13, 1], color: 0x54B5B5, neutrons: 54 },
            { atomicNumber: 43, name: "Technetium", symbol: "Tc", shells: [2, 8, 18, 13, 2], color: 0x3B9E9E, neutrons: 55 },
            { atomicNumber: 44, name: "Ruthenium", symbol: "Ru", shells: [2, 8, 18, 15, 1], color: 0x248F8F, neutrons: 57 },
            { atomicNumber: 45, name: "Rhodium", symbol: "Rh", shells: [2, 8, 18, 16, 1], color: 0x0A7D8C, neutrons: 58 },
            { atomicNumber: 46, name: "Palladium", symbol: "Pd", shells: [2, 8, 18, 18, 0], color: 0x006985, neutrons: 60 },
            { atomicNumber: 47, name: "Silver", symbol: "Ag", shells: [2, 8, 18, 18, 1], color: 0xC0C0C0, neutrons: 61 },
            { atomicNumber: 48, name: "Cadmium", symbol: "Cd", shells: [2, 8, 18, 18, 2], color: 0xFFD98F, neutrons: 64 },
            { atomicNumber: 49, name: "Indium", symbol: "In", shells: [2, 8, 18, 18, 3], color: 0xA67573, neutrons: 66 },
            { atomicNumber: 50, name: "Tin", symbol: "Sn", shells: [2, 8, 18, 18, 4], color: 0x668080, neutrons: 69 },
            { atomicNumber: 51, name: "Antimony", symbol: "Sb", shells: [2, 8, 18, 18, 5], color: 0x9D5BBA, neutrons: 71 },
            { atomicNumber: 52, name: "Tellurium", symbol: "Te", shells: [2, 8, 18, 18, 6], color: 0xD47A00, neutrons: 75 },
            { atomicNumber: 53, name: "Iodine", symbol: "I", shells: [2, 8, 18, 18, 7], color: 0x940094, neutrons: 74 },
            { atomicNumber: 54, name: "Xenon", symbol: "Xe", shells: [2, 8, 18, 18, 8], color: 0x429EB0, neutrons: 77 },
            { atomicNumber: 55, name: "Cesium", symbol: "Cs", shells: [2, 8, 18, 18, 8, 1], color: 0x57178F, neutrons: 78 },
            { atomicNumber: 56, name: "Barium", symbol: "Ba", shells: [2, 8, 18, 18, 8, 2], color: 0x00C900, neutrons: 81 },
            { atomicNumber: 57, name: "Lanthanum", symbol: "La", shells: [2, 8, 18, 18, 9, 2], color: 0x70D4FF, neutrons: 82 },
            { atomicNumber: 58, name: "Cerium", symbol: "Ce", shells: [2, 8, 18, 19, 9, 2], color: 0xFFFFC7, neutrons: 82 },
            { atomicNumber: 59, name: "Praseodymium", symbol: "Pr", shells: [2, 8, 18, 21, 8, 2], color: 0xD9FFC7, neutrons: 82 },
            { atomicNumber: 60, name: "Neodymium", symbol: "Nd", shells: [2, 8, 18, 22, 8, 2], color: 0xC7FFC7, neutrons: 84 },
            { atomicNumber: 61, name: "Promethium", symbol: "Pm", shells: [2, 8, 18, 23, 8, 2], color: 0xA3FFC7, neutrons: 84 },
            { atomicNumber: 62, name: "Samarium", symbol: "Sm", shells: [2, 8, 18, 24, 8, 2], color: 0x8FFFC7, neutrons: 88 },
            { atomicNumber: 63, name: "Europium", symbol: "Eu", shells: [2, 8, 18, 25, 8, 2], color: 0x61FFC7, neutrons: 89 },
            { atomicNumber: 64, name: "Gadolinium", symbol: "Gd", shells: [2, 8, 18, 25, 9, 2], color: 0x45FFC7, neutrons: 93 },
            { atomicNumber: 65, name: "Terbium", symbol: "Tb", shells: [2, 8, 18, 27, 8, 2], color: 0x30FFC7, neutrons: 94 },
            { atomicNumber: 66, name: "Dysprosium", symbol: "Dy", shells: [2, 8, 18, 28, 8, 2], color: 0x1FFFC7, neutrons: 96 },
            { atomicNumber: 67, name: "Holmium", symbol: "Ho", shells: [2, 8, 18, 29, 8, 2], color: 0x00FF9C, neutrons: 98 },
            { atomicNumber: 68, name: "Erbium", symbol: "Er", shells: [2, 8, 18, 30, 8, 2], color: 0x00E675, neutrons: 99 },
            { atomicNumber: 69, name: "Thulium", symbol: "Tm", shells: [2, 8, 18, 31, 8, 2], color: 0x00D452, neutrons: 100 },
            { atomicNumber: 70, name: "Ytterbium", symbol: "Yb", shells: [2, 8, 18, 32, 8, 2], color: 0x00BF38, neutrons: 103 },
            { atomicNumber: 71, name: "Lutetium", symbol: "Lu", shells: [2, 8, 18, 32, 9, 2], color: 0x00AB24, neutrons: 104 },
            { atomicNumber: 72, name: "Hafnium", symbol: "Hf", shells: [2, 8, 18, 32, 10, 2], color: 0x4DC2FF, neutrons: 106 },
            { atomicNumber: 73, name: "Tantalum", symbol: "Ta", shells: [2, 8, 18, 32, 11, 2], color: 0x4DA6FF, neutrons: 108 },
            { atomicNumber: 74, name: "Tungsten", symbol: "W", shells: [2, 8, 18, 32, 12, 2], color: 0x2194D6, neutrons: 110 },
            { atomicNumber: 75, name: "Rhenium", symbol: "Re", shells: [2, 8, 18, 32, 13, 2], color: 0x267DAB, neutrons: 111 },
            { atomicNumber: 76, name: "Osmium", symbol: "Os", shells: [2, 8, 18, 32, 14, 2], color: 0x266696, neutrons: 114 },
            { atomicNumber: 77, name: "Iridium", symbol: "Ir", shells: [2, 8, 18, 32, 15, 2], color: 0x175487, neutrons: 115 },
            { atomicNumber: 78, name: "Platinum", symbol: "Pt", shells: [2, 8, 18, 32, 17, 1], color: 0xD0D0E0, neutrons: 117 },
            { atomicNumber: 79, name: "Gold", symbol: "Au", shells: [2, 8, 18, 32, 18, 1], color: 0xFFD123, neutrons: 118 },
            { atomicNumber: 80, name: "Mercury", symbol: "Hg", shells: [2, 8, 18, 32, 18, 2], color: 0xB8B8D0, neutrons: 121 },
            { atomicNumber: 81, name: "Thallium", symbol: "Tl", shells: [2, 8, 18, 32, 18, 3], color: 0xA6534D, neutrons: 123 },
            { atomicNumber: 82, name: "Lead", symbol: "Pb", shells: [2, 8, 18, 32, 18, 4], color: 0x575961, neutrons: 125 },
            { atomicNumber: 83, name: "Bismuth", symbol: "Bi", shells: [2, 8, 18, 32, 18, 5], color: 0x9E4FB5, neutrons: 126 },
            { atomicNumber: 84, name: "Polonium", symbol: "Po", shells: [2, 8, 18, 32, 18, 6], color: 0xAB5C00, neutrons: 125 },
            { atomicNumber: 85, name: "Astatine", symbol: "At", shells: [2, 8, 18, 32, 18, 7], color: 0x754F45, neutrons: 125 },
            { atomicNumber: 86, name: "Radon", symbol: "Rn", shells: [2, 8, 18, 32, 18, 8], color: 0x428296, neutrons: 136 },
            { atomicNumber: 87, name: "Francium", symbol: "Fr", shells: [2, 8, 18, 32, 18, 8, 1], color: 0x420066, neutrons: 136 },
            { atomicNumber: 88, name: "Radium", symbol: "Ra", shells: [2, 8, 18, 32, 18, 8, 2], color: 0x007D00, neutrons: 138 },
            { atomicNumber: 89, name: "Actinium", symbol: "Ac", shells: [2, 8, 18, 32, 18, 9, 2], color: 0x70ABFA, neutrons: 138 },
            { atomicNumber: 90, name: "Thorium", symbol: "Th", shells: [2, 8, 18, 32, 20, 8, 2], color: 0x00BAFF, neutrons: 142 },
            { atomicNumber: 91, name: "Protactinium", symbol: "Pa", shells: [2, 8, 18, 32, 20, 9, 2], color: 0x00A1FF, neutrons: 140 },
            { atomicNumber: 92, name: "Uranium", symbol: "U", shells: [2, 8, 18, 32, 21, 9, 2], color: 0x008FFF, neutrons: 146 },
            { atomicNumber: 93, name: "Neptunium", symbol: "Np", shells: [2, 8, 18, 32, 22, 9, 2], color: 0x0080FF, neutrons: 146 },
            { atomicNumber: 94, name: "Plutonium", symbol: "Pu", shells: [2, 8, 18, 32, 24, 8, 2], color: 0x006BFF, neutrons: 150 },
            { atomicNumber: 95, name: "Americium", symbol: "Am", shells: [2, 8, 18, 32, 25, 8, 2], color: 0x545CF2, neutrons: 150 },
            { atomicNumber: 96, name: "Curium", symbol: "Cm", shells: [2, 8, 18, 32, 25, 9, 2], color: 0x785CE3, neutrons: 153 },
            { atomicNumber: 97, name: "Berkelium", symbol: "Bk", shells: [2, 8, 18, 32, 27, 8, 2], color: 0x8A4FE3, neutrons: 152 },
            { atomicNumber: 98, name: "Californium", symbol: "Cf", shells: [2, 8, 18, 32, 28, 8, 2], color: 0xA00066, neutrons: 153 },
            { atomicNumber: 99, name: "Einsteinium", symbol: "Es", shells: [2, 8, 18, 32, 29, 8, 2], color: 0xB31762, neutrons: 153 },
            { atomicNumber: 100, name: "Fermium", symbol: "Fm", shells: [2, 8, 18, 32, 30, 8, 2], color: 0xB31735, neutrons: 157 },
            { atomicNumber: 101, name: "Mendelevium", symbol: "Md", shells: [2, 8, 18, 32, 31, 8, 2], color: 0xB30D23, neutrons: 157 },
            { atomicNumber: 102, name: "Nobelium", symbol: "No", shells: [2, 8, 18, 32, 32, 8, 2], color: 0xBD0D18, neutrons: 157 },
            { atomicNumber: 103, name: "Lawrencium", symbol: "Lr", shells: [2, 8, 18, 32, 32, 8, 3], color: 0xC70000, neutrons: 159 },
            { atomicNumber: 104, name: "Rutherfordium", symbol: "Rf", shells: [2, 8, 18, 32, 32, 10, 2], color: 0xCC0000, neutrons: 157 },
            { atomicNumber: 105, name: "Dubnium", symbol: "Db", shells: [2, 8, 18, 32, 32, 11, 2], color: 0xCC0000, neutrons: 157 },
            { atomicNumber: 106, name: "Seaborgium", symbol: "Sg", shells: [2, 8, 18, 32, 32, 12, 2], color: 0xCC0000, neutrons: 160 },
            { atomicNumber: 107, name: "Bohrium", symbol: "Bh", shells: [2, 8, 18, 32, 32, 13, 2], color: 0xCC0000, neutrons: 160 },
            { atomicNumber: 108, name: "Hassium", symbol: "Hs", shells: [2, 8, 18, 32, 32, 14, 2], color: 0xCC0000, neutrons: 161 },
            { atomicNumber: 109, name: "Meitnerium", symbol: "Mt", shells: [2, 8, 18, 32, 32, 15, 2], color: 0xCC0000, neutrons: 161 },
            { atomicNumber: 110, name: "Darmstadtium", symbol: "Ds", shells: [2, 8, 18, 32, 32, 16, 2], color: 0xCC0000, neutrons: 161 },
            { atomicNumber: 111, name: "Roentgenium", symbol: "Rg", shells: [2, 8, 18, 32, 32, 17, 2], color: 0xCC0000, neutrons: 161 },
            { atomicNumber: 112, name: "Copernicium", symbol: "Cn", shells: [2, 8, 18, 32, 32, 18, 2], color: 0xCC0000, neutrons: 165 },
            { atomicNumber: 113, name: "Nihonium", symbol: "Nh", shells: [2, 8, 18, 32, 32, 18, 3], color: 0xCC0000, neutrons: 165 },
            { atomicNumber: 114, name: "Flerovium", symbol: "Fl", shells: [2, 8, 18, 32, 32, 18, 4], color: 0xCC0000, neutrons: 173 },
            { atomicNumber: 115, name: "Moscovium", symbol: "Mc", shells: [2, 8, 18, 32, 32, 18, 5], color: 0xCC0000, neutrons: 173 },
            { atomicNumber: 116, name: "Livermorium", symbol: "Lv", shells: [2, 8, 18, 32, 32, 18, 6], color: 0xCC0000, neutrons: 177 },
            { atomicNumber: 117, name: "Tennessine", symbol: "Ts", shells: [2, 8, 18, 32, 32, 18, 7], color: 0xCC0000, neutrons: 177 },
            { atomicNumber: 118, name: "Oganesson", symbol: "Og", shells: [2, 8, 18, 32, 32, 18, 8], color: 0xCC0000, neutrons: 176 }
        ];

        // Function to create a text sprite for atom labels in 3D
        function createTextSprite(message, color = 'white', fontSize = 64) {
            const spriteCanvas = document.createElement('canvas');
            const spriteContext = spriteCanvas.getContext('2d');
            spriteContext.font = `${fontSize}px Inter, sans-serif`;
            const metrics = spriteContext.measureText(message);
            const textWidth = metrics.width;
            const textHeight = fontSize;

            spriteCanvas.width = textWidth + 10; // Add some padding
            spriteCanvas.height = textHeight + 10;
            spriteContext.font = `${fontSize}px Inter, sans-serif`; // Redraw with new canvas size
            spriteContext.fillStyle = color;
            spriteContext.textAlign = 'center';
            spriteContext.textBaseline = 'middle';
            spriteContext.fillText(message, spriteCanvas.width / 2, spriteCanvas.height / 2);

            const texture = new THREE.CanvasTexture(spriteCanvas);
            texture.needsUpdate = true;

            const spriteMaterial = new THREE.SpriteMaterial({ map: texture });
            const sprite = new THREE.Sprite(spriteMaterial);
            sprite.scale.set(spriteCanvas.width * 0.01, spriteCanvas.height * 0.01, 1); // Scale sprite to fit scene
            return sprite;
        }

        // --- 2D Drawing Functions ---
        function init2D() {
            ctx = canvas2D.getContext('2d');
        }

        function drawAtom2D(elementData) {
            if (!ctx) {
                console.error("2D rendering context not available.");
                return; // Ensure 2D context is available
            }

            // Clear the canvas
            ctx.clearRect(0, 0, canvas2D.width, canvas2D.height);

            const centerX = canvas2D.width / 2;
            const centerY = canvas2D.height / 2;
            const maxRadius = Math.min(canvas2D.width, canvas2D.height) * 0.4; // Max radius for the outermost shell

            const nucleusRadius = maxRadius * 0.15; // Nucleus is 15% of max radius
            const protonColor = '#e74c3c'; // Red for protons
            const neutronColor = '#34495e'; // Dark blue for neutrons
            const electronRadius = maxRadius * 0.02; // Smaller radius for electrons
            const electronColor = '#3498db'; // Blue for electrons
            const electronStrokeColor = '#2980b9'; // Darker blue for electron stroke


            // Draw Nucleus
            ctx.beginPath();
            ctx.arc(centerX, centerY, nucleusRadius, 0, Math.PI * 2);
            ctx.fillStyle = '#9b59b6'; // Purple for the nucleus core
            ctx.fill();
            ctx.strokeStyle = '#8e44ad';
            ctx.lineWidth = 2;
            ctx.stroke();

            // Add a simple representation of protons/neutrons in the nucleus
            const numProtons = elementData.atomicNumber;
            const numNeutrons = elementData.neutrons;
            const totalNucleons = numProtons + numNeutrons;
            const nucleonSize = nucleusRadius * 0.15;
            
            // Distribute nucleons more evenly within the nucleus
            for (let i = 0; i < totalNucleons; i++) {
                const angle = (Math.PI * 2 / totalNucleons) * i + (Date.now() * 0.0005); // Rotate slightly
                const dist = nucleusRadius * 0.5 * (1 - (i / totalNucleons)); // Closer to center for earlier nucleons
                const x = centerX + dist * Math.cos(angle);
                const y = centerY + dist * Math.sin(angle);

                ctx.beginPath();
                ctx.arc(x, y, nucleonSize, 0, Math.PI * 2);
                ctx.fillStyle = i < numProtons ? protonColor : neutronColor; // Assign colors based on proton/neutron count
                ctx.fill();
            }


            // Draw Electron Shells and Electrons
            const numShells = elementData.shells.length;
            const shellSpacing = (maxRadius - nucleusRadius) / (numShells + 1);

            for (let i = 0; i < numShells; i++) {
                const currentShellRadius = nucleusRadius + (i + 1) * shellSpacing;
                const electronsInShell = elementData.shells[i];

                // Draw the electron shell path
                ctx.beginPath();
                ctx.arc(centerX, centerY, currentShellRadius, 0, Math.PI * 2);
                ctx.strokeStyle = `rgba(52, 152, 219, ${0.2 + i * 0.15})`; // Fading blue
                ctx.lineWidth = 1;
                ctx.stroke();

                // Draw electrons on the current shell
                for (let j = 0; j < electronsInShell; j++) {
                    // Animate electrons with a slight variation per shell
                    const animationOffset = (Date.now() * 0.0001 * (i + 1));
                    const angle = (Math.PI * 2 / electronsInShell) * j + animationOffset;
                    const electronX = centerX + currentShellRadius * Math.cos(angle);
                    const electronY = centerY + currentShellRadius * Math.sin(angle);

                    ctx.beginPath();
                    ctx.arc(electronX, electronY, electronRadius, 0, Math.PI * 2);
                    ctx.fillStyle = electronColor;
                    ctx.fill();
                    ctx.strokeStyle = electronStrokeColor;
                    ctx.lineWidth = 0.5;
                    ctx.stroke();
                }
            }

            // Draw atomic number and symbol on the nucleus
            ctx.fillStyle = 'white';
            ctx.font = `${nucleusRadius * 0.6}px Inter`;
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText(elementData.atomicNumber, centerX, centerY - nucleusRadius * 0.25);
            ctx.fillText(elementData.symbol, centerX, centerY + nucleusRadius * 0.35);
        }

        // --- 3D Drawing Functions ---
        function initializeThreeJS() {
            // Scene
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0xecf0f1); // Match canvas background

            // Camera
            camera = new THREE.PerspectiveCamera(75, canvas3D.clientWidth / canvas3D.clientHeight, 0.1, 1000);
            camera.position.z = 5; // Initial camera position

            // Renderer
            // Ensure canvas dimensions are explicitly set before creating renderer
            const canvasContainer = document.querySelector('.canvas-container');
            canvas3D.width = canvasContainer.offsetWidth; // Use offsetWidth/Height for rendered size
            canvas3D.height = canvasContainer.offsetHeight;
            
            try {
                renderer = new THREE.WebGLRenderer({ canvas: canvas3D, antialias: true });
                renderer.setSize(canvas3D.clientWidth, canvas3D.clientHeight);
                renderer.setPixelRatio(window.devicePixelRatio);
                renderer.domElement.style.display = 'none'; // Initially hide 3D renderer as 2D is default
            } catch (e) {
                console.error("Failed to create WebGL renderer:", e);
                // Disable 3D option if WebGL is not available
                mode3DRadio.disabled = true;
                mode3DRadio.nextElementSibling.textContent += " (WebGL Not Available)";
                return; // Stop initialization if renderer fails
            }

            // Lighting
            const ambientLight = new THREE.AmbientLight(0x404040); // Soft white light
            scene.add(ambientLight);
            const directionalLight1 = new THREE.DirectionalLight(0xffffff, 0.8);
            directionalLight1.position.set(1, 1, 1).normalize();
            scene.add(directionalLight1);
            const directionalLight2 = new THREE.DirectionalLight(0xffffff, 0.5);
            directionalLight2.position.set(-1, -1, -1).normalize();
            scene.add(directionalLight2);

            // OrbitControls
            controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true; // An animation loop is required when damping is enabled
            controls.dampingFactor = 0.05;
            controls.screenSpacePanning = false;
            controls.minDistance = 1;
            controls.maxDistance = 100;
            controls.enablePan = true; // Allow panning
            controls.enableZoom = true; // Allow zooming
        }

        function drawAtom3D(elementData) {
            if (!scene || !renderer) { // Ensure 3D scene and renderer are initialized
                console.error("3D scene or renderer not initialized.");
                return;
            }

            // Clear previous atom from the scene
            if (currentAtomGroup) {
                scene.remove(currentAtomGroup);
                currentAtomGroup.traverse(obj => { // Dispose children as well
                    if (obj.geometry) obj.geometry.dispose();
                    if (obj.material) {
                        if (Array.isArray(obj.material)) {
                            obj.material.forEach(mat => mat.dispose());
                        } else {
                            obj.material.dispose();
                        }
                    }
                });
            }
            
            currentAtomGroup = new THREE.Group(); // Use a group to hold all atom components
            scene.add(currentAtomGroup);

            const nucleusRadius = 0.5; // Base radius for the nucleus
            const electronRadius = 0.08; // Radius for individual electrons
            const shellBaseDistance = nucleusRadius * 2; // Starting distance for first shell
            const shellSpacing = 1.0; // Spacing between shells

            // Nucleus (Protons and Neutrons)
            const protonColor = 0xe74c3c; // Red
            const neutronColor = 0x34495e; // Dark blue
            const nucleusCoreMaterial = new THREE.MeshPhongMaterial({ color: 0x9b59b6 }); // Overall nucleus color
            const nucleusCoreGeometry = new THREE.SphereGeometry(nucleusRadius, 32, 32);
            const nucleusCoreMesh = new THREE.Mesh(nucleusCoreGeometry, nucleusCoreMaterial);
            currentAtomGroup.add(nucleusCoreMesh); // Add to main atom group

            // Add individual protons and neutrons (more accurate packing)
            const numProtons = elementData.atomicNumber;
            const numNeutrons = elementData.neutrons;
            const nucleonSize = nucleusRadius * 0.2;
            const nucleonGeometry = new THREE.SphereGeometry(nucleonSize, 8, 8);

            const nucleons = [];
            for (let i = 0; i < numProtons; i++) {
                nucleons.push({ type: 'proton', color: protonColor });
            }
            for (let i = 0; i < numNeutrons; i++) {
                nucleons.push({ type: 'neutron', color: neutronColor });
            }
            
            // Simple spherical packing for nucleons
            const goldenAngle = Math.PI * (3 - Math.sqrt(5));
            for (let i = 0; i < nucleons.length; i++) {
                const y = 1 - (i / (nucleons.length - 1)) * 2; // y goes from 1 to -1
                const radius = Math.sqrt(1 - y * y); // radius at y
                const theta = goldenAngle * i; // Golden angle distribution

                const x = Math.cos(theta) * radius;
                const z = Math.sin(theta) * radius;

                const nucleonMaterial = new THREE.MeshPhongMaterial({ color: nucleons[i].color });
                const nucleon = new THREE.Mesh(nucleonGeometry, nucleonMaterial);
                nucleon.position.set(x * nucleusRadius * 0.8, y * nucleusRadius * 0.8, z * nucleusRadius * 0.8);
                nucleusCoreMesh.add(nucleon);
            }

            // Add atomic number and symbol as text sprites to the nucleus
            const atomicNumberSprite = createTextSprite(elementData.atomicNumber.toString(), 'white', 48);
            atomicNumberSprite.position.y = nucleusRadius * 0.5;
            currentAtomGroup.add(atomicNumberSprite);

            const symbolSprite = createTextSprite(elementData.symbol, 'white', 48);
            symbolSprite.position.y = -nucleusRadius * 0.5;
            currentAtomGroup.add(symbolSprite);


            // Electron Shells and Electrons
            const electronMaterial = new THREE.MeshPhongMaterial({ color: 0x3498db }); // Blue for electrons
            const shellLineMaterial = new THREE.LineBasicMaterial({ color: 0x3498db, transparent: true, opacity: 0.3 });

            elementData.shells.forEach((electronsInShell, i) => {
                // Approximate Bohr model radii: rn = a0 * n^2 (a0 is Bohr radius, n is shell number)
                // Using a simplified scaling for visual clarity
                const shellRadius = shellBaseDistance + i * shellSpacing * (i + 1); 

                // Create a group for each shell to easily rotate electrons
                const shellGroup = new THREE.Group();
                currentAtomGroup.add(shellGroup); // Add shell group to the main atom group

                // Create multiple orbital planes for higher shells to simulate subshells
                const orbitalPlanes = [];
                if (i === 0) { // K shell (s-orbital)
                    orbitalPlanes.push({ rotation: new THREE.Euler(0, 0, 0), count: electronsInShell });
                } else if (i === 1) { // L shell (s and p orbitals)
                    // 2s orbital (circular)
                    orbitalPlanes.push({ rotation: new THREE.Euler(0, 0, 0), count: Math.min(2, electronsInShell) });
                    // 2p orbitals (3 perpendicular, if enough electrons)
                    if (electronsInShell > 2) {
                        const remainingElectrons = electronsInShell - 2;
                        const electronsPerP = Math.ceil(remainingElectrons / 3);
                        orbitalPlanes.push({ rotation: new THREE.Euler(Math.PI / 2, 0, 0), count: Math.min(electronsPerP, remainingElectrons) }); // X-Z plane
                        orbitalPlanes.push({ rotation: new THREE.Euler(0, Math.PI / 2, 0), count: Math.min(electronsPerP, remainingElectrons - electronsPerP) }); // Y-Z plane
                        orbitalPlanes.push({ rotation: new THREE.Euler(0, 0, Math.PI / 2), count: Math.min(electronsPerP, remainingElectrons - 2 * electronsPerP) }); // X-Y plane (already default)
                    }
                } else if (i === 2) { // M shell (s, p, d orbitals) - simplified d
                    // 3s orbital (circular)
                    orbitalPlanes.push({ rotation: new THREE.Euler(0, 0, 0), count: Math.min(2, electronsInShell) });
                    // 3p orbitals
                    if (electronsInShell > 2) {
                        const remainingElectrons = electronsInShell - 2;
                        const electronsPerP = Math.ceil(remainingElectrons / 3);
                        orbitalPlanes.push({ rotation: new THREE.Euler(Math.PI / 2, 0, 0), count: Math.min(electronsPerP, remainingElectrons) });
                        orbitalPlanes.push({ rotation: new THREE.Euler(0, Math.PI / 2, 0), count: Math.min(electronsPerP, remainingElectrons - electronsPerP) });
                        orbitalPlanes.push({ rotation: new THREE.Euler(0, 0, Math.PI / 2), count: Math.min(electronsPerP, remainingElectrons - 2 * electronsPerP) });
                    }
                    // Simplified 3d orbitals (add more tilted planes)
                    if (electronsInShell > 8) { // 2s + 6p = 8
                        const remainingElectrons = electronsInShell - 8;
                        const electronsPerD = Math.ceil(remainingElectrons / 5); // 5 d-orbitals
                        orbitalPlanes.push({ rotation: new THREE.Euler(Math.PI / 4, 0, 0), count: Math.min(electronsPerD, remainingElectrons) });
                        orbitalPlanes.push({ rotation: new THREE.Euler(-Math.PI / 4, 0, 0), count: Math.min(electronsPerD, remainingElectrons - electronsPerD) });
                        orbitalPlanes.push({ rotation: new THREE.Euler(0, Math.PI / 4, 0), count: Math.min(electronsPerD, remainingElectrons - 2 * electronsPerD) });
                    }
                } else { // For higher shells, just use a few tilted planes
                    orbitalPlanes.push({ rotation: new THREE.Euler(0, 0, 0), count: Math.ceil(electronsInShell / 3) });
                    orbitalPlanes.push({ rotation: new THREE.Euler(Math.PI / 2, 0, 0), count: Math.ceil(electronsInShell / 3) });
                    orbitalPlanes.push({ rotation: new THREE.Euler(0, Math.PI / 2, 0), count: electronsInShell - 2 * Math.ceil(electronsInShell / 3) });
                }

                let electronCountForShell = 0;
                orbitalPlanes.forEach(plane => {
                    const ringGeometry = new THREE.RingGeometry(shellRadius - 0.02, shellRadius + 0.02, 64);
                    const ringMesh = new THREE.Mesh(ringGeometry, shellLineMaterial);
                    ringMesh.rotation.set(plane.rotation.x, plane.rotation.y, plane.rotation.z);
                    shellGroup.add(ringMesh);

                    for (let k = 0; k < plane.count && electronCountForShell < electronsInShell; k++) {
                        const electron = new THREE.Mesh(new THREE.SphereGeometry(electronRadius, 16, 16), electronMaterial);
                        const angle = (Math.PI * 2 / plane.count) * k + (Date.now() * 0.0005 * (i + 1)); // Animate electrons
                        
                        // Calculate position based on the plane's rotation
                        const tempVec = new THREE.Vector3(shellRadius * Math.cos(angle), shellRadius * Math.sin(angle), 0);
                        tempVec.applyEuler(plane.rotation); // Apply the plane's rotation to the electron's position
                        electron.position.copy(tempVec);
                        
                        shellGroup.add(electron);
                        electronCountForShell++;
                    }
                });
                
                // Store shell group for animation
                shellGroup.userData.rotationSpeed = (i % 2 === 0 ? 0.005 : -0.005) * (i + 1); // Vary speed and direction
            });

            // Center camera on the atom
            camera.position.z = nucleusRadius * 8 + elementData.shells.length * shellSpacing * 2; // Adjust camera distance based on shells
            camera.lookAt(0, 0, 0);
            if (controls) controls.update();
        }

        // Function to update information display
        function updateElementInfo(elementData) {
            infoElement.style.display = 'block';
            infoName.textContent = elementData.name;
            infoSymbol.textContent = elementData.symbol;
            infoAtomicNumber.textContent = elementData.atomicNumber;
            infoShells.textContent = JSON.stringify(elementData.shells);
            // Hide shells info in 3D mode as it's not visually represented
            infoShells.parentElement.style.display = (currentMode === '2D' ? 'block' : 'none');
        }

        // Handle atomic number input change
        function handleAtomicNumberChange() {
            const atomicNumber = parseInt(atomicNumberInput.value);
            const elementData = elements.find(el => el.atomicNumber === atomicNumber);

            if (elementData) {
                updateElementInfo(elementData);
                if (currentMode === '2D') {
                    drawAtom2D(elementData);
                } else {
                    drawAtom3D(elementData);
                }
            } else {
                // Handle invalid atomic number
                infoElement.style.display = 'none';
                if (currentMode === '2D' && ctx) {
                    ctx.clearRect(0, 0, canvas2D.width, canvas2D.height); // Clear 2D canvas
                } else if (currentMode === '3D' && scene) {
                    // Clear 3D scene
                    if (currentAtomGroup) scene.remove(currentAtomGroup);
                    currentAtomGroup = null;
                }
                console.warn("Element not found for atomic number:", atomicNumber);
            }
        }

        // Function to switch between 2D and 3D modes
        function switchMode(mode) {
            currentMode = mode;
            if (mode === '2D') {
                canvas2D.style.display = 'block'; // Show 2D canvas
                canvas3D.style.display = 'none'; // Hide 3D canvas
                init2D(); // Re-initialize 2D context
            } else { // 3D
                if (!renderer) { // If renderer failed to initialize on load, don't try again
                    console.warn("3D renderer not available. Cannot switch to 3D mode.");
                    mode2DRadio.checked = true; // Revert to 2D selection
                    currentMode = '2D';
                    return;
                }
                canvas2D.style.display = 'none'; // Hide 2D canvas
                canvas3D.style.display = 'block'; // Show 3D canvas
                
                // Update renderer size and camera aspect ratio on mode switch
                const canvasContainer = document.querySelector('.canvas-container');
                canvas3D.width = canvasContainer.clientWidth;
                canvas3D.height = canvasContainer.clientHeight;
                if (camera && renderer) {
                    camera.aspect = canvas3D.clientWidth / canvas3D.clientHeight;
                    camera.updateProjectionMatrix();
                    renderer.setSize(canvas3D.clientWidth, canvas3D.clientHeight);
                }
            }
            handleAtomicNumberChange(); // Redraw the current atom in the new mode
        }

        // Animation loop for rendering
        let animationFrameId;
        function animate() {
            animationFrameId = requestAnimationFrame(animate);

            if (currentMode === '2D') {
                const atomicNumber = parseInt(atomicNumberInput.value);
                const elementData = elements.find(el => el.atomicNumber === atomicNumber);
                if (elementData) {
                    drawAtom2D(elementData); // Redraw atom to animate electrons
                }
            } else { // 3D
                if (controls) controls.update();

                // Animate electron shells in 3D
                if (currentAtomGroup) {
                    currentAtomGroup.children.forEach(child => {
                        // Check if child is a shell group (has userData.rotationSpeed)
                        if (child.userData.rotationSpeed !== undefined) {
                            child.rotation.z += child.userData.rotationSpeed; // Rotate shells around Z-axis
                            // Optional: add slight rotation around other axes for more dynamic look
                            // child.rotation.x += child.userData.rotationSpeed * 0.1;
                        }
                    });
                }

                if (renderer && scene && camera) renderer.render(scene, camera);
            }
        }

        // Initialize the simulator
        window.onload = function() {
            // Set canvas dimensions to match its container
            const canvasContainer = document.querySelector('.canvas-container');
            
            canvas2D.width = canvasContainer.offsetWidth; 
            canvas2D.height = canvasContainer.offsetHeight;
            canvas3D.width = canvasContainer.offsetWidth; 
            canvas3D.height = canvasContainer.offsetHeight;

            // Initialize Three.js components once on load
            initializeThreeJS();

            // Set initial atomic number and draw the atom
            atomicNumberInput.value = 1; // Default to Hydrogen
            // Call switchMode to correctly set up the initial 2D view and hide the 3D renderer
            switchMode('2D'); 

            // Add event listeners
            atomicNumberInput.addEventListener('input', handleAtomicNumberChange);
            mode2DRadio.addEventListener('change', () => switchMode('2D'));
            mode3DRadio.addEventListener('change', () => switchMode('3D'));

            // Handle window resize to redraw canvases
            window.addEventListener('resize', () => {
                const canvasContainer = document.querySelector('.canvas-container');
                canvas2D.width = canvasContainer.clientWidth;
                canvas2D.height = canvasContainer.clientHeight;
                canvas3D.width = canvasContainer.clientWidth;
                canvas3D.height = canvasContainer.clientHeight;

                if (currentMode === '3D' && camera && renderer) {
                    camera.aspect = canvas3D.clientWidth / canvas3D.clientHeight;
                    camera.updateProjectionMatrix();
                    renderer.setSize(canvas3D.clientWidth, canvas3D.clientHeight);
                }
                handleAtomicNumberChange(); // Redraw atom with new dimensions
            });

            // Start animation
            animate();
        };
    </script>
</body>
</html>